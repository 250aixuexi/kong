<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无人机路径规划智能体</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .visualization {
            flex: 1;
            min-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .controls {
            flex: 0 0 350px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .panel {
            margin-bottom: 25px;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
        }
        
        button {
            background: #4CAF50;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .results {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .status.warning {
            background: rgba(255, 193, 7, 0.3);
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.3);
        }
        
        #plotly-chart {
            width: 100%;
            height: 600px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        @media (max-width: 1100px) {
            .content {
                flex-direction: column;
            }
            
            .visualization, .controls {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>无人机路径规划智能体</h1>
            <p class="subtitle">基于遗传算法的城市环境无人机路径规划系统</p>
        </header>
        
        <div class="content">
            <div class="visualization">
                <h2>3D 可视化</h2>
                <div id="plotly-chart"></div>
            </div>
            
            <div class="controls">
                <div class="panel">
                    <h2>模型参数</h2>
                    <div class="form-group">
                        <label for="num-blocks">街区数量</label>
                        <select id="num-blocks">
                            <option value="2">2x2</option>
                            <option value="3" selected>3x3</option>
                            <option value="4">4x4</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="num-destinations">抵达点数量</label>
                        <select id="num-destinations">
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="start-x">起点 X 坐标</label>
                        <input type="number" id="start-x" value="10" min="0" max="300">
                    </div>
                    
                    <div class="form-group">
                        <label for="start-y">起点 Y 坐标</label>
                        <input type="number" id="start-y" value="10" min="0" max="300">
                    </div>
                    
                    <div class="form-group">
                        <label for="start-z">起点 Z 坐标</label>
                        <input type="number" id="start-z" value="80" min="50" max="150">
                    </div>
                    
                    <button id="generate-model">生成城市模型</button>
                </div>
                
                <div class="panel">
                    <h2>算法参数</h2>
                    <div class="form-group">
                        <label for="population-size">种群大小</label>
                        <input type="number" id="population-size" value="50" min="10" max="200">
                    </div>
                    
                    <div class="form-group">
                        <label for="max-generations">最大迭代次数</label>
                        <input type="number" id="max-generations" value="100" min="10" max="500">
                    </div>
                    
                    <div class="form-group">
                        <label for="mutation-rate">变异率</label>
                        <input type="number" id="mutation-rate" value="0.2" min="0" max="1" step="0.05">
                    </div>
                    
                    <div class="form-group">
                        <label for="crossover-rate">交叉率</label>
                        <input type="number" id="crossover-rate" value="0.8" min="0" max="1" step="0.05">
                    </div>
                    
                    <button id="run-algorithm">运行遗传算法</button>
                </div>
                
                <div class="panel">
                    <h2>图例说明</h2>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: rgb(150, 100, 150);"></div>
                            <span>建筑物</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: green;"></div>
                            <span>换电站</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: red;"></div>
                            <span>起点</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: blue;"></div>
                            <span>抵达点</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: orange;"></div>
                            <span>飞行路径</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="results">
            <h2>路径规划结果</h2>
            <div id="status-message" class="status">等待生成模型...</div>
            
            <div class="metrics">
                <div class="metric-card">
                    <div class="metric-label">目标函数值</div>
                    <div class="metric-value" id="total-cost">-</div>
                    <div class="metric-label">min f = ?</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">路径长度</div>
                    <div class="metric-value" id="path-length">-</div>
                    <div class="metric-label">米</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">风险代价</div>
                    <div class="metric-value" id="risk-value">-</div>
                    <div class="metric-label">数值</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">能量消耗</div>
                    <div class="metric-value" id="energy-value">-</div>
                    <div class="metric-label">数值</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">飞行时间</div>
                    <div class="metric-value" id="time-value">-</div>
                    <div class="metric-label">秒</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化3D场景
        function initializeScene() {
            const layout = {
                title: '无人机路径规划',
                scene: {
                    xaxis: { title: 'X (米)' },
                    yaxis: { title: 'Y (米)' },
                    zaxis: { title: 'Z (米)' },
                    aspectmode: 'data',
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.2}
                    }
                },
                width: 800,
                height: 600,
                margin: {l: 0, r: 0, b: 0, t: 50}
            };
            
            Plotly.newPlot('plotly-chart', [], layout);
        }
        
        // 更新状态消息
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = 'status';
            
            if (type === 'success') {
                statusEl.classList.add('success');
            } else if (type === 'warning') {
                statusEl.classList.add('warning');
            } else if (type === 'error') {
                statusEl.classList.add('error');
            }
        }
        
        // 模拟生成城市模型
        function generateCityModel() {
            updateStatus('正在生成城市模型...', 'warning');
            
            // 模拟异步操作
            setTimeout(() => {
                const numBlocks = parseInt(document.getElementById('num-blocks').value);
                updateStatus(`成功生成 ${numBlocks}x${numBlocks} 城市街区模型`, 'success');
                
                // 这里应该调用Python后端生成实际模型
                // 目前使用模拟数据
                simulateModelGeneration();
            }, 1500);
        }
        
        // 模拟运行遗传算法
        function runGeneticAlgorithm() {
            updateStatus('正在运行遗传算法进行路径规划...', 'warning');
            
            // 模拟异步操作
            setTimeout(() => {
                updateStatus('遗传算法完成，已找到最优路径', 'success');
                
                // 更新结果指标
                document.getElementById('total-cost').textContent = '142.36';
                document.getElementById('path-length').textContent = '485.72';
                document.getElementById('risk-value').textContent = '12.45';
                document.getElementById('energy-value').textContent = '4.86';
                document.getElementById('time-value').textContent = '60.71';
                
                // 这里应该调用Python后端运行实际算法
                // 目前使用模拟数据
                simulatePathGeneration();
            }, 2000);
        }
        
        // 模拟模型生成
        function simulateModelGeneration() {
            // 创建一些模拟建筑数据
            const buildings = [];
            const numBlocks = parseInt(document.getElementById('num-blocks').value);
            const blockSize = 100;
            
            for (let blockX = 0; blockX < numBlocks; blockX++) {
                for (let blockY = 0; blockY < numBlocks; blockY++) {
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            if (Math.random() > 0.3) {
                                const height = Math.floor(Math.random() * 80) + 20;
                                buildings.push({
                                    x: blockX * blockSize + i * 25 + 5,
                                    y: blockY * blockSize + j * 25 + 5,
                                    z: 0,
                                    width: 15 + Math.floor(Math.random() * 10) - 5,
                                    depth: 15 + Math.floor(Math.random() * 10) - 5,
                                    height: height,
                                    color: `rgb(${100 + Math.floor(height / 2)}, 100, 150)`
                                });
                            }
                        }
                    }
                }
            }
            
            // 创建一些模拟换电站
            const chargingStations = [];
            const citySize = numBlocks * blockSize;
            const numStations = Math.floor(Math.random() * 3) + 5; // 5-7个换电站
            
            for (let i = 0; i < numStations; i++) {
                chargingStations.push({
                    x: Math.random() * (citySize - 20) + 10,
                    y: Math.random() * (citySize - 20) + 10,
                    z: 0,
                    radius: 3,
                    color: 'green'
                });
            }
            
            // 更新3D可视化
            updateVisualization(buildings, chargingStations, [], []);
        }
        
        // 模拟路径生成
        function simulatePathGeneration() {
            // 获取起点
            const startX = parseInt(document.getElementById('start-x').value);
            const startY = parseInt(document.getElementById('start-y').value);
            const startZ = parseInt(document.getElementById('start-z').value);
            
            // 生成模拟抵达点
            const destinations = [];
            const numDestinations = parseInt(document.getElementById('num-destinations').value);
            
            const safeZones = [
                [50, 50], [50, 150], [50, 250],
                [150, 50], [150, 150], [150, 250],
                [250, 50], [250, 150], [250, 250]
            ];
            
            for (let i = 0; i < numDestinations; i++) {
                if (i < safeZones.length) {
                    const [x, y] = safeZones[i];
                    destinations.push([
                        x + Math.random() * 40 - 20,
                        y + Math.random() * 40 - 20,
                        Math.random() * 50 + 50
                    ]);
                }
            }
            
            // 生成模拟路径
            const path = [[startX, startY, startZ]];
            
            // 随机生成路径点
            for (let i = 0; i < numDestinations + 3; i++) {
                const lastPoint = path[path.length - 1];
                path.push([
                    lastPoint[0] + Math.random() * 60 - 30,
                    lastPoint[1] + Math.random() * 60 - 30,
                    Math.random() * 30 + 60
                ]);
            }
            
            // 添加抵达点到路径中
            destinations.forEach(dest => {
                const insertIndex = Math.floor(Math.random() * (path.length - 2)) + 1;
                path.splice(insertIndex, 0, dest);
            });
            
            // 更新3D可视化
            updateVisualization([], [], path, destinations, [startX, startY, startZ]);
        }
        
        // 更新3D可视化
        function updateVisualization(buildings, chargingStations, path, destinations, startPoint) {
            const traces = [];
            
            // 添加建筑
            buildings.forEach(building => {
                // 简化的建筑可视化
                const x = [building.x, building.x + building.width, building.x + building.width, building.x, building.x];
                const y = [building.y, building.y, building.y + building.depth, building.y + building.depth, building.y];
                const z = [0, 0, 0, 0, 0];
                
                traces.push({
                    type: 'mesh3d',
                    x: [
                        building.x, building.x + building.width, building.x + building.width, building.x,
                        building.x, building.x + building.width, building.x + building.width, building.x
                    ],
                    y: [
                        building.y, building.y, building.y + building.depth, building.y + building.depth,
                        building.y, building.y, building.y + building.depth, building.y + building.depth
                    ],
                    z: [
                        0, 0, 0, 0,
                        building.height, building.height, building.height, building.height
                    ],
                    i: [0, 0, 0, 4, 4, 1],
                    j: [1, 3, 4, 5, 6, 2],
                    k: [2, 4, 7, 6, 7, 6],
                    color: building.color,
                    opacity: 0.7,
                    flatshading: true,
                    name: '建筑'
                });
            });
            
            // 添加换电站
            if (chargingStations.length > 0) {
                traces.push({
                    type: 'scatter3d',
                    mode: 'markers',
                    x: chargingStations.map(s => s.x),
                    y: chargingStations.map(s => s.y),
                    z: chargingStations.map(s => s.z),
                    marker: {
                        size: 8,
                        color: 'green',
                        symbol: 'circle',
                        line: { width: 2, color: 'darkgreen' }
                    },
                    name: '换电站'
                });
            }
            
            // 添加起点
            if (startPoint) {
                traces.push({
                    type: 'scatter3d',
                    mode: 'markers',
                    x: [startPoint[0]],
                    y: [startPoint[1]],
                    z: [startPoint[2]],
                    marker: {
                        size: 10,
                        color: 'red',
                        symbol: 'circle',
                        line: { width: 2, color: 'darkred' }
                    },
                    name: '起点'
                });
            }
            
            // 添加抵达点
            if (destinations.length > 0) {
                traces.push({
                    type: 'scatter3d',
                    mode: 'markers',
                    x: destinations.map(d => d[0]),
                    y: destinations.map(d => d[1]),
                    z: destinations.map(d => d[2]),
                    marker: {
                        size: 8,
                        color: 'blue',
                        symbol: 'square',
                        line: { width: 2, color: 'darkblue' }
                    },
                    name: '抵达点'
                });
            }
            
            // 添加路径
            if (path.length > 0) {
                traces.push({
                    type: 'scatter3d',
                    mode: 'lines+markers',
                    x: path.map(p => p[0]),
                    y: path.map(p => p[1]),
                    z: path.map(p => p[2]),
                    line: { color: 'red', width: 4 },
                    marker: { size: 4, color: 'orange' },
                    name: '飞行路径'
                });
            }
            
            // 更新图表
            const layout = {
                title: path.length > 0 ? '无人机路径规划结果' : '城市建筑模型',
                scene: {
                    xaxis: { title: 'X (米)' },
                    yaxis: { title: 'Y (米)' },
                    zaxis: { title: 'Z (米)' },
                    aspectmode: 'data',
                    camera: {
                        eye: {x: 1.5, y: 1.5, z: 1.2}
                    }
                },
                width: 800,
                height: 600,
                margin: {l: 0, r: 0, b: 0, t: 50}
            };
            
            Plotly.react('plotly-chart', traces, layout);
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeScene();
            
            // 绑定事件
            document.getElementById('generate-model').addEventListener('click', generateCityModel);
            document.getElementById('run-algorithm').addEventListener('click', runGeneticAlgorithm);
            
            // 初始生成模型
            generateCityModel();
        });
    </script>
</body>
</html>
